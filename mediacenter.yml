---

- name: Run mediacenter playbook
  hosts: mediacenter
  gather_facts: no
  connection: local
  tags: build
  pre_tasks:
    - include_vars: "vars/main.yml"
  tasks: 
    - name: Add Group
      group:
        name: htpc
        state: present
    - name: Add User
      user:
        name: htpc
        comment: htpc
        group: htpc
        state: present
    - name: Install Docker python dependencies
      pip: name={{ item }} state=latest
      with_items:
        - virtualenv
        - docker-py
        - pyopenssl
    - name: Run main task file
      import_tasks: tasks/main.yml

- hosts: mediacenter
  gather_facts: no
  roles:
    - { role: reverse_proxy, service_name: plex, dest_port: "{{plex_port}}", listen_port: 80}
    - { role: reverse_proxy, service_name: deluge, dest_port: "{{deluged_port}}", listen_port: 80}
    - { role: reverse_proxy, service_name: couchpotato, dest_port: "{{couchpotato_port}}", listen_port: 80}
    - { role: reverse_proxy, service_name: sickbeard, dest_port: "{{sickbeard_port}}", listen_port: 80}
